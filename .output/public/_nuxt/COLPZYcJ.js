import{_ as I}from"./yNrD7jeP.js";import{r as m,k as ae,m as ne,A as oe,z as re,c as _,a as c,b as s,g as a,w as u,a6 as q,F as b,i as N,o as p,d as g,t as y,ag as v,C as se,az as R,aA as B}from"./CQhMbuYm.js";import{b as ie,$ as de,a as x,_ as le,c as ue}from"./BklFbpMv.js";import{_ as ce}from"./DpbL5SEU.js";import{_ as me}from"./ClO5iSXl.js";import{_ as fe}from"./JRgNOWyO.js";import{_ as _e}from"./CoaxiW6z.js";import{_ as pe}from"./CGvy3zGA.js";import{_ as ge}from"./B3zaNuK4.js";import{c as ye,a as P,d as ve}from"./CfhmW9is.js";import{u as be}from"./D9TaRR3o.js";import"./C-5-UFas.js";import"./DEV0Xyba.js";import"./Ccy20JML.js";import"./DImwLAFM.js";const xe={class:"flex justify-between items-center gap-4"},$e={class:"flex justify-end gap-2"},he={class:"flex justify-between"},Se={class:"flex gap-4 items-center"},we={class:"flex justify-between w-full"},Ce={class:"text-xl font-bold text-primary"},Ue={key:0,class:"flex flex-col gap-4"},ke={class:"grid grid-cols-2 my-6 place-items-center"},ze={class:"flex justify-end items-center gap-2 mt-4 border-t border-gray-200 pt-4"},Be={__name:"index",setup(De){const $=m(!1),h=m(!1),M=m([]),E=m([]),S=m(!1),f=m(!1),w=ae(),C=new ie("en-US",{dateStyle:"medium"}),U=m(!1),V=m(!1),F=be(),O=de(x()),Y=O.subtract({days:7}),d=m({start:Y,end:O}),G=async()=>{S.value=!S.value,await z({date_from:d.value.start?.toString(),date_to:d.value.end?.toString()})},n=ne({id:void 0,student_id:void 0,day:void 0,in:void 0,out:void 0,user:void 0}),K=()=>{n.id=void 0,n.student_id=void 0,n.day=void 0,n.in=void 0,n.out=void 0,n.user=void 0},W=ye({student_id:ve().typeError("User is required").required("User is required"),day:P().matches(/^\d{4}-\d{2}-\d{2}$/,"Date must be in YYYY-MM-DD format").required("Date is required"),in:P().matches(/^([01]\d|2[0-3]):([0-5]\d):([0-5]\d)$/,"In Time must be HH:mm:ss").required("In Time is required"),out:P().matches(/^([01]\d|2[0-3]):([0-5]\d):([0-5]\d)$/,"Out Time must be HH:mm:ss").required("Out Time is required")}),J=[{accessorKey:"day",header:"Date"},{accessorKey:"student_id",header:"Name",cell:({row:t})=>(console.log("row",M.value),t.original.first_yiddish_name+" "+t.original.last_yiddish_name)},{accessorKey:"morning_in",header:"Morning In"},{accessorKey:"morning_out",header:"Morning Out"},{accessorKey:"retzifus_morning",header:"Retzifus"},{accessorKey:"retzifus_morning",header:"",cell:({row:t})=>v("div",{class:"flex gap-2 items-center"},[v(I,{text:"Edit User"},{default:()=>v(N,{icon:"i-lucide-square-pen",size:"md",color:"success",variant:"soft",onClick:()=>H(t.original,"morning")})})])},{accessorKey:"total_morning",header:"Total morning"},{accessorKey:"afternoon_in",header:"Afternoon In"},{accessorKey:"afternoon_out",header:"Afternoon out"},{accessorKey:"retzifus_evening",header:"Retzifus"},{accessorKey:"retzifus_morning",header:"",cell:({row:t})=>v("div",{class:"flex gap-2 items-center"},[v(I,{text:"Edit User"},{default:()=>v(N,{icon:"i-lucide-square-pen",size:"md",color:"success",variant:"soft",onClick:()=>H(t.original,"evening")})})])},{accessorKey:"total_afternoon",header:"Total Afternoon"}],k=t=>{if(t==null)return"-";let e=Math.floor(t/3600);const o=Math.floor(t%3600/60),r=t%60,l=e>=12?"PM":"AM";return e=e%12||12,`${e.toString().padStart(2,"0")}:${o.toString().padStart(2,"0")}:${r.toString().padStart(2,"0")} ${l}`},j=(t,e)=>{if(!t||!e)return"-";const o=t/e*100;return`${Math.round(o)}%`},L=(t=[])=>t.map(e=>{const o={morning_in:"-",morning_out:"-",total_morning:"-",retzifus_morning:"-",evening_in:"-",evening_out:"-",total_evening:"-",retzifus_evening:"-",...e};return e.clocking.forEach(r=>{r.session===1&&(o.morning_in=k(r.in),o.morning_out=k(r.out),o.total_morning=j(r.out-r.in,r.schedule_total),o.retzifus_morning=r.retzifus===0?"NO":"-"),r.session===2&&(o.afternoon_in=k(r.in),o.afternoon_out=k(r.out),o.total_afternoon=j(r.out-r.in,r.schedule_total),o.retzifus_evening=r.retzifus===0?"NO":"-")}),o}),z=async t=>{try{V.value=!0;const e=await F("/api/clockings",{method:"GET",params:{date_from:t?.date_from,date_to:t?.date_to,error_only:S.value}});e?.success&&(E.value=e?.students.map(o=>({label:o?.first_yiddish_name+" "+o?.last_yiddish_name,value:o?.id})),M.value=L(e?.clockings))}catch(e){console.log("ðŸš€ ~ fetchStudents ~ err:",e)}finally{V.value=!1}},Q=async t=>{U.value=!0;const e=n?.id?`/api/clockings/${n.id}`:"/api/clockings",o=n?.id?"PUT":"POST",r=n?.id?{in:t.data.in,out:t.data.out}:{in:t.data.in,out:t.data.out,student_id:t.data.student_id,day:t.data.day};try{const l=await F(e,{method:o,body:r});l?.success?(w.add({title:"Success",description:l?.message?l?.message:n.id?"Clocking updated successfully":"Clocking created successfully",color:"success",duration:2e3}),n.id=null,await z({date_from:d.value.start?.toString(),date_to:d.value.end?.toString()})):l?._data?.message?w.add({title:"Failed",description:l._data.message,color:"error"}):w.add({title:"Failed",description:l?.message||"Something went wrong. Please try again.",color:"error"})}catch(l){console.error("Submission error:",l),w.add({title:"Error",description:"An unexpected error occurred.",color:"error"})}finally{f.value=!1,U.value=!1,K()}},D=t=>{if(!t)return"";const[e,o]=t.split(" ");let[r,l,A]=e.split(":").map(Number);return o==="PM"&&r!==12&&(r+=12),o==="AM"&&r===12&&(r=0),`${r.toString().padStart(2,"0")}:${l.toString().padStart(2,"0")}:${A.toString().padStart(2,"0")}`},H=(t,e)=>{n.id=t.student_id,n.student_id=t.student_id,n.day=t.day;const o=t.first_yiddish_name+" "+t.last_yiddish_name+" "+t.day;n.user=o,e==="morning"?(n.in=D(t.morning_in),n.out=D(t.morning_out)):e==="evening"&&(n.in=D(t.afternoon_in),n.out=D(t.afternoon_out)),f.value=!0};return oe(async()=>{await z({date_from:d.value.start?.toString(),date_to:d.value.end?.toString()})}),re(()=>d.value,async t=>{!t?.start||!t?.end||($.value=!1,await z({date_from:t.start.toString(),date_to:t.end.toString()}))},{deep:!0}),(t,e)=>{const o=N,r=ue,l=le,A=ce,X=me,Z=fe,T=_e,ee=pe,te=ge;return p(),_(b,null,[c("div",xe,[e[12]||(e[12]=c("h2",{class:"text-xl font-bold my-4"},"This Weeks Clockings",-1)),c("div",$e,[s(o,{onClick:e[0]||(e[0]=i=>{f.value=!0,a(n).id=void 0}),icon:"i-lucide-plus",label:"Create New Clockings",class:"text-white",color:"primary",variant:"solid"}),s(o,{icon:"i-lucide-file-text",label:"Export to PDF"})])]),c("div",he,[c("div",Se,[s(l,{open:a($),"onUpdate:open":e[2]||(e[2]=i=>q($)?$.value=i:null)},{content:u(()=>[s(r,{modelValue:a(d),"onUpdate:modelValue":e[1]||(e[1]=i=>q(d)?d.value=i:null),range:"","number-of-months":2,class:"p-2"},null,8,["modelValue"])]),default:u(()=>[s(o,{color:"neutral",variant:"outline",size:"lg",icon:"i-lucide-calendar"},{default:u(()=>[a(d).start?(p(),_(b,{key:0},[a(d).end?(p(),_(b,{key:0},[g(y(a(C).format(a(d).start.toDate(a(x)())))+" - "+y(a(C).format(a(d).end.toDate(a(x)()))),1)],64)):(p(),_(b,{key:1},[g(y(a(C).format(a(d).start.toDate(a(x)()))),1)],64))],64)):(p(),_(b,{key:1},[g(" Pick a date ")],64))]),_:1})]),_:1},8,["open"]),s(A,{"model-value":a(S),"onUpdate:modelValue":G,label:"Show only with error",ui:{base:"cursor-pointer"}},null,8,["model-value"])]),s(o,{to:"/clockings/requests",icon:"",label:"Requests",variant:"outline"})]),s(X,{columns:J,loading:a(V),data:a(M),class:"flex-1 mt-6"},null,8,["loading","data"]),s(te,{open:a(f),"onUpdate:open":e[11]||(e[11]=i=>q(f)?f.value=i:null)},{header:u(()=>[c("div",we,[c("h2",Ce,y(a(n)?.id?"Edit "+a(n).user:"Create New Clockings"),1),s(o,{size:"sm",variant:"outline",color:"primary",class:"rounded-full p-2",icon:"i-lucide-x",onClick:e[3]||(e[3]=()=>{f.value=!1,K()})})])]),body:u(()=>[c("div",null,[s(ee,{schema:a(W),state:a(n),class:"space-y-4",onSubmit:Q},{default:u(()=>[a(n).id?se("",!0):(p(),_("div",Ue,[s(T,{label:"User",name:"user"},{default:u(()=>[s(Z,{modelValue:a(n).student_id,"onUpdate:modelValue":e[4]||(e[4]=i=>a(n).student_id=i),modelModifiers:{number:!0},items:a(E),class:"w-full",size:"lg",placeholder:"Select User",required:""},null,8,["modelValue","items"])]),_:1}),s(T,{label:"Day",name:"day"},{default:u(()=>[s(l,{class:"w-full",open:a(h),"onUpdate:open":e[7]||(e[7]=i=>q(h)?h.value=i:null)},{content:u(()=>[s(r,{modelValue:a(n).day,"onUpdate:modelValue":[e[5]||(e[5]=i=>a(n).day=i),e[6]||(e[6]=i=>h.value=!1)],class:"p-2"},null,8,["modelValue"])]),default:u(()=>[s(o,{color:"neutral",variant:"outline",icon:"i-lucide-calendar",size:"lg"},{default:u(()=>[g(y(a(n)?.day?a(C).format(a(n)?.day.toDate(a(x)())):"Select a date"),1)]),_:1})]),_:1},8,["open"])]),_:1})])),c("div",ke,[s(T,{label:"In",class:"flex gap-4 items-center"},{default:u(()=>[R(c("input",{"onUpdate:modelValue":e[8]||(e[8]=i=>a(n).in=i),type:"time",name:"in",id:"in",step:"1",class:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary focus:border-primary p-2.5",required:""},null,512),[[B,a(n).in]])]),_:1}),s(T,{label:"Out",class:"flex gap-4 items-center"},{default:u(()=>[R(c("input",{"onUpdate:modelValue":e[9]||(e[9]=i=>a(n).out=i),type:"time",name:"out",id:"out",step:"1",class:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary focus:border-primary p-2.5",required:""},null,512),[[B,a(n).out]])]),_:1})]),c("div",ze,[s(o,{color:"neutral",variant:"solid",onClick:e[10]||(e[10]=()=>{f.value=!1,K()})},{default:u(()=>[...e[13]||(e[13]=[g(" Cancel ",-1)])]),_:1}),s(o,{type:"submit",loading:a(U),disabled:a(U)},{default:u(()=>[g(y(a(n)?.id?"Edit":"Create")+" Clockings ",1)]),_:1},8,["loading","disabled"])])]),_:1},8,["schema","state"])])]),_:1},8,["open"])],64)}}};export{Be as default};
