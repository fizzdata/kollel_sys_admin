import{f as Y,k as M,r as y,m as O,z as T,A as W,j as z,o as b,w as o,c as q,g as a,b as t,a as p,i as E,d as x,t as F,a6 as I}from"./CQhMbuYm.js";import{_ as D}from"./D6JetA8M.js";import{_ as R}from"./Caw1bJKe.js";import{_ as G}from"./CoaxiW6z.js";import{_ as H}from"./JRgNOWyO.js";import{_ as J}from"./CGvy3zGA.js";import{_ as K}from"./B3zaNuK4.js";import{c as Q,a as u}from"./CfhmW9is.js";import{u as X}from"./D9TaRR3o.js";const Z={class:"flex justify-between w-full"},ee={class:"text-xl font-bold text-primary"},se={key:0,class:"flex items-center justify-center pt-10 w-full"},ae={key:1},te={class:"grid grid-cols-2 gap-4"},le={class:"grid grid-cols-2 gap-4"},de={class:"flex justify-end items-center gap-2 mt-4 border-t border-gray-200 pt-4"},fe={__name:"CommonStudentCreateEditModal",props:{modelValue:{type:Boolean,default:!1},selectedStudent:{type:Object,default:()=>({})}},emits:["update:modelValue","submit","cancel"],setup($,{emit:C}){const n=$,w=C,m=Y({get:()=>n.modelValue,set:d=>w("update:modelValue",d)}),f=M(),S=X(),g=y(!1),V=y([]),v=y(!1),h=y(!1),k=Q({first_name:u().required("First Name is required"),last_name:u().required("Last Name is required"),first_yiddish_name:u().required("Yeddish First Name is required"),last_yiddish_name:u().required("Yeddish Last Name is required"),phone:u().required("Phone is required").matches(/^\d{10}$/,"Phone must be exactly 10 digits"),address:u().required("Address is required"),wage:u().required("Wage is required")}),e=O({id:n?.selectedStudent?.id||null,first_name:n?.selectedStudent?.first_name||"",last_name:n?.selectedStudent?.last_name||"",first_yiddish_name:n?.selectedStudent?.first_yiddish_name||"",last_yiddish_name:n?.selectedStudent?.last_yiddish_name||"",phone:n?.selectedStudent?.phone||"",address:n?.selectedStudent?.address||"",wage:n?.selectedStudent?.wage||""});T(()=>n.selectedStudent,d=>{d&&Object.assign(e,d)},{immediate:!0,deep:!0});const N=()=>{e.id=null,e.first_name="",e.last_name="",e.first_yiddish_name="",e.last_yiddish_name="",e.phone="",e.address="",e.wage=""},U=()=>{N(),w("cancel")},B=async d=>{h.value=!0;const s=e.id?`/api/students/${e.id}`:"/api/students",_=e.id?"PUT":"POST";delete d.data.id;try{const i=await S(s,{method:_,body:d.data});i?.success?(v.value=!1,f.add({title:"Success",description:i?.message?i?.message:e.id?"Student updated successfully":"Student created successfully",color:"success",duration:2e3}),e.id=null,m.value=!1,w("submit")):i?._data?.message?f.add({title:"Failed",description:i._data.message,color:"error"}):f.add({title:"Failed",description:i?.message||"Something went wrong. Please try again.",color:"error"})}catch(i){console.error("Submission error:",i),f.add({title:"Error",description:"An unexpected error occurred.",color:"error"})}finally{N(),v.value=!1,h.value=!1}},P=async()=>{try{g.value=!0;const d=await S("/api/payroll/groups");d?.success&&(V.value=d.wages_groups.map(s=>({label:s.name,value:s.id})))}catch(d){console.log("ðŸš€ ~ fetchwages ~ err:",d)}finally{g.value=!1}};return W(async()=>{await P()}),(d,s)=>{const _=E,i=D,c=R,r=G,j=H,A=J,L=K;return b(),z(L,{open:a(m),"onUpdate:open":s[9]||(s[9]=l=>I(m)?m.value=l:null)},{header:o(()=>[p("div",Z,[p("h2",ee,F(a(e)?.id?"Update Student":"Create New Student"),1),t(_,{size:"sm",variant:"outline",color:"primary",class:"rounded-full p-2",icon:"i-lucide-x",onClick:s[0]||(s[0]=()=>{m.value=!1,U()})})])]),body:o(()=>[a(g)?(b(),q("div",se,[t(i,{"show-loader":a(g),size:"md"},null,8,["show-loader"])])):(b(),q("div",ae,[t(A,{schema:a(k),state:a(e),class:"space-y-4",onSubmit:B},{default:o(()=>[p("div",te,[t(r,{label:"First Name",name:"first_name"},{default:o(()=>[t(c,{modelValue:a(e).first_name,"onUpdate:modelValue":s[1]||(s[1]=l=>a(e).first_name=l),placeholder:"First Name",class:"w-full"},null,8,["modelValue"])]),_:1}),t(r,{label:"Last Name",name:"last_name"},{default:o(()=>[t(c,{modelValue:a(e).last_name,"onUpdate:modelValue":s[2]||(s[2]=l=>a(e).last_name=l),placeholder:"Last Name",class:"w-full"},null,8,["modelValue"])]),_:1})]),p("div",le,[t(r,{label:"Yiddish First Name",name:"first_yiddish_name"},{default:o(()=>[t(c,{modelValue:a(e).first_yiddish_name,"onUpdate:modelValue":s[3]||(s[3]=l=>a(e).first_yiddish_name=l),placeholder:"First Name",class:"w-full"},null,8,["modelValue"])]),_:1}),t(r,{label:"Yeddish Last Name",name:"last_yiddish_name"},{default:o(()=>[t(c,{modelValue:a(e).last_yiddish_name,"onUpdate:modelValue":s[4]||(s[4]=l=>a(e).last_yiddish_name=l),placeholder:"Last Name",class:"w-full"},null,8,["modelValue"])]),_:1})]),t(r,{label:"Phone",name:"phone"},{default:o(()=>[t(c,{modelValue:a(e).phone,"onUpdate:modelValue":s[5]||(s[5]=l=>a(e).phone=l),placeholder:"Phone Number",class:"w-full"},null,8,["modelValue"])]),_:1}),t(r,{label:"Address",name:"address"},{default:o(()=>[t(c,{modelValue:a(e).address,"onUpdate:modelValue":s[6]||(s[6]=l=>a(e).address=l),placeholder:"Address",class:"w-full"},null,8,["modelValue"])]),_:1}),t(r,{label:"Wage",name:"wage"},{default:o(()=>[t(j,{modelValue:a(e).wage,"onUpdate:modelValue":s[7]||(s[7]=l=>a(e).wage=l),items:a(V),class:"w-full",placeholder:"Select Your Wage"},null,8,["modelValue","items"])]),_:1}),p("div",de,[t(_,{color:"neutral",variant:"solid",onClick:s[8]||(s[8]=()=>{m.value=!1})},{default:o(()=>[...s[10]||(s[10]=[x(" Cancel ",-1)])]),_:1}),t(_,{type:"submit",loading:a(h),disabled:a(h)},{default:o(()=>[x(F(a(e)?.id?"Update Student":"Create Student"),1)]),_:1},8,["loading","disabled"])])]),_:1},8,["schema","state"])]))]),_:1},8,["open"])}}};export{fe as _};
