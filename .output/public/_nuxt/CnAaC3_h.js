import{r as w,f as R,g as l,m as ne,A as ie,z as oe,ak as J,p as ue,al as ce,q as de,am as fe,s as pe,x as X,ao as me,c as B,o as m,b as n,w as D,C as A,F as K,B as x,a as c,E as b,h as ve,H as ee,d as j,t as P,j as N,i as Q,D as te,W as le,a3 as ge,V as ae,G as ye,ax as be,P as he,k as xe,ay as we,a6 as Y,ag as I,e as ze}from"./CQhMbuYm.js";import{_ as Se}from"./yNrD7jeP.js";import{_ as se}from"./DpbL5SEU.js";import{_ as ke}from"./D8yCJ5HV.js";import{_ as $e}from"./Caw1bJKe.js";import{_ as Fe}from"./ClO5iSXl.js";import{_ as Ce}from"./B4U9YR6u.js";import{a as qe,b as Be,c as De}from"./Ccy20JML.js";import{_ as Te}from"./B3zaNuK4.js";import{u as Ue}from"./D9TaRR3o.js";import"./C-5-UFas.js";import"./CoaxiW6z.js";import"./JRgNOWyO.js";import"./DEV0Xyba.js";import"./D6JetA8M.js";import"./CGvy3zGA.js";import"./CfhmW9is.js";import"./DImwLAFM.js";function Ae(i){if(!i||i==="*")return;const v=i.split(",").map(S=>{const t=S.trim();return t.includes("/")&&t.endsWith("/*")&&t.split("/")[0]||t}).filter(S=>!S.startsWith("."));return v.length>0?v:void 0}function Ve(i){const{accept:v="*",reset:S=!1,multiple:t=!1,dropzone:k=!0,onUpdate:F}=i,a=w(),z=w(),_=R(()=>Ae(l(v))),T=(r,C=!1)=>{if(!(!r||r.length===0)){if(r instanceof FileList&&(r=Array.from(r)),r.length>1&&!t&&(r=[r[0]]),C&&a.value?.$el)try{const q=new DataTransfer;r.forEach(p=>q.items.add(p)),a.value.$el.files=q.files}catch(q){console.warn("Could not sync files to input element:",q)}F(r)}},h=w(!1),V=ne({open:()=>{}});function $(){V.open()}return ie(()=>{const{isOverDropZone:r}=k?qe(z,{dataTypes:_.value,onDrop:p=>T(p,!0)}):{isOverDropZone:w(!1)};oe(r,p=>{h.value=p});const{onChange:C,open:q}=Be({accept:l(v),multiple:t,input:l(a)?.$el,reset:S});V.open=q,C(p=>T(p,!1))}),{isDragging:h,open:$,inputRef:a,dropzoneRef:z}}const _e={slots:{root:"relative flex flex-col",base:["w-full flex-1 bg-default border border-default flex flex-col gap-2 items-stretch justify-center rounded-lg focus-visible:outline-2","transition-[background]"],wrapper:"flex flex-col items-center justify-center text-center",icon:"shrink-0",avatar:"shrink-0",label:"font-medium text-default mt-2",description:"text-muted mt-1",actions:"flex flex-wrap gap-1.5 shrink-0 mt-4",files:"",file:"relative",fileLeadingAvatar:"shrink-0",fileWrapper:"flex flex-col min-w-0",fileName:"text-default truncate",fileSize:"text-muted truncate",fileTrailingButton:""},variants:{color:{primary:"",secondary:"",success:"",info:"",warning:"",error:"",neutral:""},variant:{area:{wrapper:"px-4 py-3",base:"p-4"},button:{}},size:{xs:{base:"text-xs",icon:"size-4",file:"text-xs px-2 py-1 gap-1",fileWrapper:"flex-row gap-1"},sm:{base:"text-xs",icon:"size-4",file:"text-xs px-2.5 py-1.5 gap-1.5",fileWrapper:"flex-row gap-1"},md:{base:"text-sm",icon:"size-5",file:"text-xs px-2.5 py-1.5 gap-1.5"},lg:{base:"text-sm",icon:"size-5",file:"text-sm px-3 py-2 gap-2",fileSize:"text-xs"},xl:{base:"text-base",icon:"size-6",file:"text-sm px-3 py-2 gap-2"}},layout:{list:{root:"gap-2 items-start",files:"flex flex-col w-full gap-2",file:"min-w-0 flex items-center border border-default rounded-md w-full",fileTrailingButton:"ms-auto"},grid:{fileWrapper:"hidden",fileLeadingAvatar:"size-full rounded-lg",fileTrailingButton:"absolute -top-1.5 -end-1.5 p-0 rounded-full border-2 border-bg"}},position:{inside:"",outside:""},dropzone:{true:"border-dashed data-[dragging=true]:bg-elevated/25"},interactive:{true:""},highlight:{true:""},multiple:{true:""},disabled:{true:"cursor-not-allowed opacity-75"}},compoundVariants:[{color:"primary",class:"focus-visible:outline-primary"},{color:"secondary",class:"focus-visible:outline-secondary"},{color:"success",class:"focus-visible:outline-success"},{color:"info",class:"focus-visible:outline-info"},{color:"warning",class:"focus-visible:outline-warning"},{color:"error",class:"focus-visible:outline-error"},{color:"primary",highlight:!0,class:"border-primary"},{color:"secondary",highlight:!0,class:"border-secondary"},{color:"success",highlight:!0,class:"border-success"},{color:"info",highlight:!0,class:"border-info"},{color:"warning",highlight:!0,class:"border-warning"},{color:"error",highlight:!0,class:"border-error"},{color:"neutral",class:"focus-visible:outline-inverted"},{color:"neutral",highlight:!0,class:"border-inverted"},{size:"xs",layout:"list",class:{fileTrailingButton:"-me-1"}},{size:"sm",layout:"list",class:{fileTrailingButton:"-me-1.5"}},{size:"md",layout:"list",class:{fileTrailingButton:"-me-1.5"}},{size:"lg",layout:"list",class:{fileTrailingButton:"-me-2"}},{size:"xl",layout:"list",class:{fileTrailingButton:"-me-2"}},{variant:"button",size:"xs",class:{base:"p-1"}},{variant:"button",size:"sm",class:{base:"p-1.5"}},{variant:"button",size:"md",class:{base:"p-1.5"}},{variant:"button",size:"lg",class:{base:"p-2"}},{variant:"button",size:"xl",class:{base:"p-2"}},{layout:"grid",multiple:!0,class:{files:"grid grid-cols-2 md:grid-cols-3 gap-4 w-full",file:"p-0 aspect-square"}},{layout:"grid",multiple:!1,class:{file:"absolute inset-0 p-0"}},{interactive:!0,disabled:!1,class:"hover:bg-elevated/25"}],defaultVariants:{color:"primary",variant:"area",size:"md"}},Le=Object.assign({inheritAttrs:!1},{__name:"UFileUpload",props:J({as:{type:null,required:!1},id:{type:String,required:!1},name:{type:String,required:!1},icon:{type:null,required:!1},label:{type:String,required:!1},description:{type:String,required:!1},color:{type:null,required:!1},variant:{type:null,required:!1},size:{type:null,required:!1},layout:{type:null,required:!1,default:"grid"},position:{type:null,required:!1,default:"outside"},highlight:{type:Boolean,required:!1},accept:{type:String,required:!1,default:"*"},multiple:{type:Boolean,required:!1,default:!1},reset:{type:Boolean,required:!1,default:!1},dropzone:{type:Boolean,required:!1,default:!0},interactive:{type:Boolean,required:!1,default:!0},required:{type:Boolean,required:!1},disabled:{type:Boolean,required:!1},fileIcon:{type:null,required:!1},fileDelete:{type:[Boolean,Object],required:!1,default:!0},fileDeleteIcon:{type:null,required:!1},preview:{type:Boolean,required:!1,default:!0},class:{type:null,required:!1},ui:{type:null,required:!1}},{modelValue:{type:null},modelModifiers:{}}),emits:J(["change"],["update:modelValue"]),setup(i,{expose:v,emit:S}){const t=i,k=S,F=ue(),a=ce(i,"modelValue"),z=de(),{t:_}=fe(),[T,h]=De(),{isDragging:V,open:$,inputRef:r,dropzoneRef:C}=Ve({accept:t.accept,reset:t.reset,multiple:t.multiple,dropzone:t.dropzone,onUpdate:E}),{emitFormInput:q,emitFormChange:p,id:G,name:H,disabled:M,ariaAttrs:Z}=pe(t),U=R(()=>t.multiple?"area":t.variant),W=R(()=>t.variant==="button"&&!t.multiple?"grid":t.layout),o=R(()=>W.value==="grid"&&t.multiple?"inside":U.value==="button"?"outside":t.position),e=R(()=>X({extend:X(_e),...z.ui?.fileUpload||{}})({dropzone:t.dropzone,interactive:t.interactive,color:t.color,size:t.size,variant:U.value,layout:W.value,position:o.value,multiple:t.multiple,highlight:t.highlight,disabled:t.disabled}));function d(s){return URL.createObjectURL(s)}function O(s){if(s===0)return"0B";const f=1024,u=["B","KB","MB","GB"],g=Math.floor(Math.log(s)/Math.log(f)),y=s/Math.pow(f,g);return`${g===0?y.toString():y.toFixed(0)}${u[g]}`}function E(s,f=!1){if(t.multiple)if(f)a.value=s;else{const g=a.value||[];a.value=[...g,...s||[]]}else a.value=s?.[0];const u=new Event("change",{target:{value:a.value}});k("change",u),p(),q()}function L(s){if(!a.value)return;if(!t.multiple||s===void 0){E([],!0),C.value?.focus();return}const f=[...a.value];f.splice(s,1),E(f,!0),C.value?.focus()}return oe(a,s=>{(t.multiple?!s?.length:!s)&&r.value?.$el&&(r.value.$el.value="")}),v({inputRef:me(()=>r.value?.$el),dropzoneRef:C}),(s,f)=>(m(),B(K,null,[n(l(T),null,{default:D(()=>[t.preview&&a.value&&(!Array.isArray(a.value)||a.value.length)?(m(),B(K,{key:0},[x(s.$slots,"files-top",{files:a.value,open:l($),removeFile:L}),c("div",{"data-slot":"files",class:b(e.value.files({class:t.ui?.files}))},[x(s.$slots,"files",{files:a.value},()=>[(m(!0),B(K,null,ve(Array.isArray(a.value)?a.value:[a.value],(u,g)=>(m(),B("div",{key:u.name,"data-slot":"file",class:b(e.value.file({class:t.ui?.file}))},[x(s.$slots,"file",{file:u,index:g},()=>[x(s.$slots,"file-leading",{file:u,index:g,ui:e.value},()=>[n(ee,{as:{img:"img"},src:d(u),icon:i.fileIcon||l(z).ui.icons.file,size:t.size,"data-slot":"fileLeadingAvatar",class:b(e.value.fileLeadingAvatar({class:t.ui?.fileLeadingAvatar}))},null,8,["src","icon","size","class"])]),c("div",{"data-slot":"fileWrapper",class:b(e.value.fileWrapper({class:t.ui?.fileWrapper}))},[c("span",{"data-slot":"fileName",class:b(e.value.fileName({class:t.ui?.fileName}))},[x(s.$slots,"file-name",{file:u,index:g},()=>[j(P(u.name),1)])],2),c("span",{"data-slot":"fileSize",class:b(e.value.fileSize({class:t.ui?.fileSize}))},[x(s.$slots,"file-size",{file:u,index:g},()=>[j(P(O(u.size)),1)])],2)],2),x(s.$slots,"file-trailing",{file:u,index:g,ui:e.value},()=>[i.fileDelete?(m(),N(Q,te({key:0,color:"neutral"},{ref_for:!0},{...W.value==="grid"?{variant:"solid",size:"xs"}:{variant:"link",size:i.size},...typeof i.fileDelete=="object"?i.fileDelete:void 0},{"aria-label":l(_)("fileUpload.removeFile",{filename:u.name}),"trailing-icon":i.fileDeleteIcon||l(z).ui.icons.close,"data-slot":"fileTrailingButton",class:e.value.fileTrailingButton({class:t.ui?.fileTrailingButton}),onClick:le(y=>L(g),["stop","prevent"])}),null,16,["aria-label","trailing-icon","class","onClick"])):A("",!0)])])],2))),128))])],2),x(s.$slots,"files-bottom",{files:a.value,open:l($),removeFile:L})],64)):A("",!0)]),_:3}),n(l(he),{as:i.as,"data-slot":"root",class:b(e.value.root({class:[t.ui?.root,t.class]}))},{default:D(()=>[x(s.$slots,"default",{open:l($),removeFile:L,ui:e.value},()=>[(m(),N(ge(U.value==="button"?"button":"div"),{ref_key:"dropzoneRef",ref:C,type:U.value==="button"?"button":void 0,role:U.value==="button"?void 0:"button","data-dragging":l(V),"data-slot":"base",class:b(e.value.base({class:t.ui?.base})),tabindex:i.interactive&&!l(M)?0:-1,onClick:f[0]||(f[0]=u=>i.interactive&&!l(M)&&l($)()),onKeydown:f[1]||(f[1]=ae(le(()=>{},["prevent"]),["space"])),onKeyup:f[2]||(f[2]=ae(u=>i.interactive&&!l(M)&&l($)(),["enter","space"]))},{default:D(()=>[o.value==="inside"?(m(),N(l(h),{key:0})):A("",!0),o.value!=="inside"||(i.multiple?!a.value?.length:!a.value)?(m(),B("div",{key:1,"data-slot":"wrapper",class:b(e.value.wrapper({class:t.ui?.wrapper}))},[x(s.$slots,"leading",{ui:e.value},()=>[U.value==="button"?(m(),N(ye,{key:0,name:i.icon||l(z).ui.icons.upload,"data-slot":"icon",class:b(e.value.icon({class:t.ui?.icon}))},null,8,["name","class"])):(m(),N(ee,{key:1,icon:i.icon||l(z).ui.icons.upload,size:t.size,"data-slot":"avatar",class:b(e.value.avatar({class:t.ui?.avatar}))},null,8,["icon","size","class"]))]),U.value!=="button"?(m(),B(K,{key:0},[i.label||F.label?(m(),B("div",{key:0,"data-slot":"label",class:b(e.value.label({class:t.ui?.label}))},[x(s.$slots,"label",{},()=>[j(P(i.label),1)])],2)):A("",!0),i.description||F.description?(m(),B("div",{key:1,"data-slot":"description",class:b(e.value.description({class:t.ui?.description}))},[x(s.$slots,"description",{},()=>[j(P(i.description),1)])],2)):A("",!0),F.actions?(m(),B("div",{key:2,"data-slot":"actions",class:b(e.value.actions({class:t.ui?.actions}))},[x(s.$slots,"actions",{files:a.value,open:l($),removeFile:L})],2)):A("",!0)],64)):A("",!0)],2)):A("",!0)]),_:3},40,["type","role","data-dragging","class","tabindex"])),o.value==="outside"?(m(),N(l(h),{key:0})):A("",!0)]),n(l(be),te({id:l(G),ref_key:"inputRef",ref:r,as:"input",type:"file",feature:"fully-hidden",name:l(H),accept:i.accept,multiple:i.multiple,required:i.required,disabled:l(M)},{...s.$attrs,...l(Z)}),null,16,["id","name","accept","multiple","required","disabled"])]),_:3},8,["as","class"])],64))}}),Me={class:"flex flex-col md:flex-row justify-between md:items-center gap-4 mb-4 md:mb-0"},Ne={class:"flex justify-end gap-2"},Re={class:"flex gap-4 items-center my-6"},je={class:"flex justify-between w-full"},We={class:"bg-white border border-gray-200 rounded-lg p-4 text-sm mt-2"},Ee={class:"flex flex-col gap-3"},rt={__name:"index",setup(i){const v=w(null),S=Ue(),t=w(!1),k=w(!1),F=w(!1),a=xe(),z=w([]),_=w(!1),T=w(!1),h=w(""),V=w(null),$=()=>{V.value=null},r=[{accessorKey:"first_name",header:"Full Name",cell:({row:o})=>I(ze,{to:`/students/${o.original.id}`,class:"text-primary hover:underline cursor-pointer"},()=>o.original.first_name+" "+o.original.last_name)},{accessorKey:"fingerprints",header:"Fingerprints"},{accessorKey:"first_yiddish_name",header:"First Yiddish Name"},{accessorKey:"last_yiddish_name",header:"Last Yiddish Name"},{accessorKey:"phone",header:"Phone"},{header:"Quick Actions",cell:({row:o})=>I("div",{class:"flex gap-2 items-center"},[I(Se,{text:"Edit Student"},{default:()=>I(Q,{icon:"i-lucide-square-pen",size:"md",color:"success",variant:"soft",onClick:()=>C(o.original)})}),I(se,{modelValue:o.original.active,"onUpdate:modelValue":e=>q(o.original),color:"primary",size:"md",ui:{base:"cursor-pointer"}})])}],C=o=>{V.value=o,t.value=!0,fetchwages()},q=async o=>{const e=!o.active;o.active=e;try{const d=await S(`/api/students/${o.id}/status`,{method:"PATCH",body:{active:e}});d?.success?(a.add({title:"Success",description:d?.msg?d?.msg:"Student deactivated",color:"success",duration:2e3}),await p()):(a.add({title:"Failed",description:d?.msg?d?.msg:"Unable to deactivate.",color:"error",duration:2e3}),await p())}catch(d){console.error("Submission error:",d),a.add({title:"Error",description:"An unexpected error occurred.",color:"error"})}},p=async()=>{const o=T.value?"/api/students?active_only=true":"/api/students?active_only=false";try{_.value=!0;const e=await S(o);e?.success&&(z.value=e?.Students)}catch(e){console.log("ðŸš€ ~ fetchStudents ~ err:",e)}finally{_.value=!1}},G=R(()=>{if(!h.value)return z.value;const o=h.value.toLowerCase();return z.value.filter(e=>e.first_name?.toLowerCase().includes(o)||e.last_name?.toLowerCase().includes(o)||e.last_yiddish_name?.toLowerCase().includes(o)||e.first_yiddish_name?.toLowerCase().includes(o))}),H=async()=>{t.value=!0},M=async()=>{k.value=!0},Z=()=>{p()},U=async()=>{if(!v.value){a.add({title:"Failed",description:"Please Select File.",color:"error"});return}F.value=!0;const o=new FormData;o.append("file",v.value);try{const e=await S("/api/students/import",{method:"POST",body:o});e?.success?(k.value=!1,a.add({title:"Success",description:e?.message?e?.message:"Data imported successfully",color:"success",duration:2e3}),await p()):e?._data?.message?a.add({title:"Failed",description:e._data.message,color:"error"}):a.add({title:"Failed",description:e?.message||"Something went wrong. Please try again.",color:"error"})}catch(e){console.error("Submission error:",e),a.add({title:"Error",description:"An unexpected error occurred.",color:"error"})}finally{v.value=null,k.value=!1,F.value=!1}};ie(async()=>{await p()});const W=async()=>{T.value=!T.value,await p()};return(o,e)=>{const d=Q,O=ke,E=$e,L=se,s=Fe,f=Ce,u=Le,g=Te;return m(),B(K,null,[n(O,{class:"rounded-2xl shadow-sm"},{default:D(()=>[c("div",Me,[e[6]||(e[6]=c("h2",{class:"text-xl font-bold"},"All Students",-1)),c("div",Ne,[n(d,{onClick:H,icon:"i-lucide-circle-plus",label:"Create New Student"}),n(d,{onClick:M,icon:"i-lucide-file-text",label:"Import Students"})])])]),_:1}),c("div",Re,[n(E,{modelValue:l(h),"onUpdate:modelValue":e[1]||(e[1]=y=>Y(h)?h.value=y:null),icon:"i-lucide-search",size:"md",variant:"outline",placeholder:"Search...",ui:{trailing:"pe-1"}},we({_:2},[l(h)?.length?{name:"trailing",fn:D(()=>[n(d,{color:"neutral",variant:"link",size:"sm",icon:"i-lucide-circle-x","aria-label":"Clear input",onClick:e[0]||(e[0]=y=>h.value="")})]),key:"0"}:void 0]),1032,["modelValue"]),n(L,{"model-value":l(T),"onUpdate:modelValue":W,label:"Active Only"},null,8,["model-value"])]),n(O,null,{default:D(()=>[n(s,{columns:r,loading:l(_),data:l(G),class:"flex-1 mt-6"},null,8,["loading","data"])]),_:1}),n(f,{modelValue:l(t),"onUpdate:modelValue":e[2]||(e[2]=y=>Y(t)?t.value=y:null),selectedStudent:l(V)||{},onSubmit:Z,onCancel:$},null,8,["modelValue","selectedStudent"]),n(g,{open:l(k),"onUpdate:open":e[5]||(e[5]=y=>Y(k)?k.value=y:null)},{header:D(()=>[c("div",je,[e[7]||(e[7]=c("h2",{class:"text-xl font-bold text-primary"},"Import Students",-1)),n(d,{size:"sm",variant:"outline",color:"primary",class:"rounded-full p-2",icon:"i-lucide-x",onClick:e[3]||(e[3]=()=>{$(),k.value=!1})})])]),body:D(()=>[n(u,{modelValue:l(v),"onUpdate:modelValue":e[4]||(e[4]=y=>Y(v)?v.value=y:null),icon:"i-lucide-file-text",label:"Drop your file here",description:"xlsx,xls or csv (max. 2MB)",layout:"list",multiple:!1,accept:".xlsx,.xls,.csv",interactive:!1,class:"w-full min-h-48"},{actions:D(({open:y})=>[n(d,{label:"Select File",icon:"i-lucide-upload",color:"neutral",variant:"outline",onClick:re=>y()},null,8,["onClick"])]),_:1},8,["modelValue"]),c("div",We,[c("div",Ee,[e[8]||(e[8]=c("div",null,[c("p",{class:"font-bold text-gray-700"},"Required Format:"),c("p",{class:"text-primary"},[j(" Your Excel must contain the first row as headers:"),c("br"),c("span",{class:"font-semibold text-brand-700"}," First Name | Last Name | First Yiddish Name | Last Yiddish Name | Phone | Address | Wage Group "),c("br")])],-1)),n(d,{label:"Download Sample Sheet",color:"primary",variant:"outline",icon:"i-lucide-download",class:"rounded-lg h-fit w-64",ui:{base:"border border-gray-600"}})])]),n(d,{type:"submit",loading:l(F),disabled:l(F),class:"w-full flex justify-center items-center mt-4",onClick:U},{default:D(()=>[...e[9]||(e[9]=[j(" Import Student ",-1)])]),_:1},8,["loading","disabled"])]),_:1},8,["open"])],64)}}};export{rt as default};
