import{r as v,A as q,z as nt,c as y,o as m,a as e,b as i,w as g,d as b,i as Q,t as a,F as E,h as I,C as $,g as s,af as ot,k as at,j,a6 as L,H as it,G as rt,E as lt}from"./CQhMbuYm.js";import{_ as ct}from"./D6JetA8M.js";import{_ as dt}from"./mXRS76AO.js";import{_ as ut}from"./D8yCJ5HV.js";import{_ as mt}from"./DkxBZUJD.js";import{G as R,F as _t,a as ft,H as pt}from"./BwspBaMW.js";import{_ as gt}from"./ClO5iSXl.js";import{_ as ht}from"./B4U9YR6u.js";import{u as xt}from"./D9TaRR3o.js";import"./B3zaNuK4.js";import"./Ccy20JML.js";import"./Caw1bJKe.js";import"./CoaxiW6z.js";import"./JRgNOWyO.js";import"./CGvy3zGA.js";import"./CfhmW9is.js";import"./DImwLAFM.js";const vt={class:"calendar"},yt={class:"flex justify-between items-center mb-4 flex-wrap gap-2"},bt={class:"text-2xl font-bold text-gray-900 text-center flex-1"},wt={class:"overflow-x-auto"},kt={class:"min-w-full border-collapse table-auto"},St={class:"bg-gray-200"},$t={key:0,class:"text-xs sm:text-sm font-semibold text-center"},Ct={class:"text-gray-400 text-[10px] sm:text-xs"},Dt={key:1,class:"mt-2 text-[10px] sm:text-xs p-2 space-y-1 flex flex-col gap-1"},Mt={class:"bg-blue-50 rounded"},zt={class:"ml-1 text-gray-900"},At={class:"bg-blue-50 rounded"},jt={class:"ml-1 text-gray-900"},Tt={__name:"StudentCalender",props:{items:{type:Array,default:()=>[]}},setup(Y){const H=Y,N=v([]),w=new Date,T=["×ª×©×¨×™","×—×©×•×Ÿ","×›×¡×œ×•","×˜×‘×ª","×©×‘×˜","××“×¨ ×'","××“×¨ ×‘'","× ×™×¡×Ÿ","××™×™×¨","×¡×™×•×Ÿ","×ª×ž×•×–","××‘","××œ×•×œ"];function n(p){return p.toISOString().split("T")[0]}function C(p){const[r,d,l]=n(p).split("-"),k=R(r,d,l).split("/");return{month:+k[0],day:+k[1],year:k[2]}}const K=C(w),x=v(K.year),f=v(K.month);function U(){return`${T[f.value-1]} ${_t(x.value)}`}function P(){return pt(x.value,f.value,1)}function B(p){return H.items.find(r=>r.day===p)||null}function D(){const p=P(),r=[];let d=[],l=new Date(p);for(let c=0;c<p.getDay();c++)d.push({date:null,data:null});const k=R(l.getFullYear(),l.getMonth()+1,l.getDate()).split("/")[0];for(;;){const c=n(l);if(d.push({date:c,data:B(c)}),l.setDate(l.getDate()+1),d.length===7&&(r.push(d),d=[]),R(l.getFullYear(),l.getMonth()+1,l.getDate()).split("/")[0]!==k){if(d.length){for(;d.length<7;)d.push({date:null,data:null});r.push(d)}break}}N.value=r}function V(){f.value===1?(f.value=13,x.value--):f.value--,D()}function O(){f.value===13?(f.value=1,x.value++):f.value++,D()}function z(p){if(!p)return"";const[r,d,l]=p.split("-");return ft(r,d,l)}return q(D),nt(()=>H.items,D,{deep:!0}),(p,r)=>{const d=Q;return m(),y("div",vt,[e("div",yt,[i(d,{onClick:V,icon:"i-lucide-arrow-left",color:"primary",variant:"solid"},{default:g(()=>[...r[0]||(r[0]=[b(" Previous ",-1)])]),_:1}),e("h2",bt,a(U()),1),i(d,{onClick:O,"trailing-icon":"i-lucide-arrow-right",color:"primary",variant:"solid"},{default:g(()=>[...r[1]||(r[1]=[b(" Next ",-1)])]),_:1})]),e("div",wt,[e("table",kt,[e("thead",null,[e("tr",St,[(m(),y(E,null,I(7,l=>e("th",{key:l,class:"p-2 border text-center text-xs sm:text-sm border-gray-300"},a(["×–×•× ×˜××’","×ž×× ×˜××’","×“×™× ×¡×˜××’","×ž×™×˜×•×•××š","×“×× ×¢×¨×©×˜××’","×¤×¨×™×™×˜××’","×©×‘×ª ×§×•×“×©"][l-1]),1)),64))])]),e("tbody",null,[(m(!0),y(E,null,I(s(N),(l,k)=>(m(),y("tr",{key:k},[(m(!0),y(E,null,I(l,(c,F)=>(m(),y("td",{key:F,class:"p-2 border border-gray-300 align-top min-w-30"},[c.date?(m(),y("div",$t,[b(a(z(c.date))+" ",1),e("div",Ct,a(c.date),1)])):$("",!0),c.data?(m(),y("div",Dt,[e("div",Mt,[e("span",zt,a(c.data.morning_in)+" â€“ "+a(c.data.morning_out)+" | "+a(c.data.retzifus_morning)+" | "+a(c.data.total_morning),1)]),e("div",At,[e("span",jt,a(c.data.afternoon_in)+" â€“ "+a(c.data.afternoon_out)+" | "+a(c.data.retzifus_evening)+" | "+a(c.data.total_afternoon),1)])])):$("",!0)]))),128))]))),128))])])])])}}},Kt={class:"flex flex-col md:flex-row md:justify-between items-center gap-4"},Nt={class:"flex items-start w-full md:w-fit"},Ut={class:"flex items-center"},Pt={class:"flex items-center divide-x divide-gray-300"},Bt={class:"px-1"},Ft={class:"px-1"},Ht={key:0,class:"flex items-center justify-center pt-10 w-full"},Vt={key:1},Ot={class:"flex items-center gap-6"},Gt={class:"flex-1"},Et={class:"flex justify-between"},It={class:"text-xl font-semibold"},Rt={class:"text-sm text-gray-500"},Yt={class:"mt-2 grid grid-cols-1 gap-2 text-sm"},Lt={class:"flex gap-1 mt-2 items-center"},qt={class:"grid md:grid-cols-3 gap-4 my-6"},Qt={class:"flex gap-4"},Wt={class:"flex h-10 w-10 items-center justify-center rounded-full bg-primary-50 shrink-0 self-center"},Jt={class:"flex-1"},Xt={class:"flex justify-between items-center"},Zt={class:"text-xl font-semibold"},te={class:"flex gap-4"},ee={class:"flex h-10 w-10 items-center justify-center rounded-full bg-amber-50 shrink-0 self-center"},se={class:"flex-1"},ne={class:"flex justify-between items-center mb-1"},oe={class:"text-lg font-semibold"},ae={class:"flex justify-between items-center"},ie={class:"text-lg font-semibold"},re={class:"flex gap-4"},le={class:"flex h-10 w-10 items-center justify-center rounded-full bg-indigo-50 shrink-0 self-center"},ce={class:"flex-1"},de={class:"flex justify-between items-center mb-1"},ue={class:"text-lg font-semibold"},me={class:"flex justify-between items-center"},_e={class:"text-lg font-semibold"},fe={key:2},Te={__name:"[id]",setup(Y){const N=ot().params.id,w=v(!1),T=xt(),n=v({}),C=v(!1),K=v(null),x=v("0"),f=at(),U=v([]),P=v([]),B=v([]),D=v([]),V=[{label:"Clockings",key:"clockings",icon:"i-lucide-clock"},{label:"Deposits",key:"transactions",icon:"i-lucide-credit-card"},{label:"Checks",key:"checks",icon:"i-lucide-file-check"},{label:"Responses",key:"responses",icon:"i-lucide-help-circle"}],O=o=>o?Object.values(o).map(t=>{const _=Array.isArray(t.clocking)?t.clocking:Object.values(t.clocking||{}),h={day:t.day,morning_in:"-",morning_out:"-",retzifus_morning:"-",total_morning:"-",afternoon_in:"-",afternoon_out:"-",retzifus_evening:"-",total_afternoon:"-"};return _.forEach(u=>{u.session===1&&(h.morning_in=z(u.in),h.morning_out=z(u.out),h.retzifus_morning=u.retzifus===0?"NO":"-",h.total_morning=p(u.out-u.in,u.schedule_total)),u.session===2&&(h.afternoon_in=z(u.in),h.afternoon_out=z(u.out),h.retzifus_evening=u.retzifus===0?"NO":"-",h.total_afternoon=p(u.out-u.in,u.schedule_total))}),h}):[],z=o=>{if(o==null)return"-";let t=Math.floor(o/3600);const _=Math.floor(o%3600/60),h=o%60,u=t>=12?"PM":"AM";return t=t%12||12,`${t.toString().padStart(2,"0")}:${_.toString().padStart(2,"0")}:${h.toString().padStart(2,"0")} ${u}`},p=(o,t)=>{if(!o||!t)return"-";const _=o/t*100;return`${Math.round(_)}%`},r=async(o=!1)=>{try{o&&(w.value=!0);const t=await T(`/api/students/${N}`);t&&(n.value=t,U.value=O(t?.clockings),P.value=t?.transactions,B.value=t?.Student_responses,D.value=t?.checks)}catch(t){console.log("ðŸš€ ~ fetchStudentDetail ~ err:",t)}finally{o&&(w.value=!1)}},d=async()=>{await r(!0)},l=()=>{C.value=!1},k=[{accessorKey:"date",header:"Date"},{accessorKey:"amount",header:"Amount"},{accessorKey:"description",header:"Description"}],c=[{accessorKey:"student_id",header:"Name",cell:({row:o})=>n.value?.Student?.first_name+" "+n.value?.Student?.last_name},{accessorKey:"amount",header:"Amount"},{accessorKey:"check_date",header:"Check Date"},{accessorKey:"check_number",header:"Check Number"},{accessorKey:"cleared",header:"Cleared",cell:({row:o})=>o.original.cleared===1?"Paid":"Not Paid"},{accessorKey:"pay_to",header:"Pay To"}],F=[{accessorKey:"date",header:"Date"},{accessorKey:"question",header:"Question"},{accessorKey:"answer",header:"Answer"}],W=o=>{K.value=o,C.value=!0},J=async o=>{const t=!o.active;o.active=t;try{const _=await T(`/api/students/${o.id}/status`,{method:"PATCH",body:{active:t}});_?.success?(f.add({title:"Success",description:_?.msg?_?.msg:"Student deactivated",color:"success",duration:2e3}),await r(!1)):(f.add({title:"Failed",description:_?.msg?_?.msg:"Unable to deactivate.",color:"error",duration:2e3}),await r(!1))}catch(_){console.error("Submission error:",_),f.add({title:"Error",description:"An unexpected error occurred.",color:"error"})}},X=async o=>{try{const t=await T("/api/students/reset-passwords",{method:"POST",body:{id:o.id}});t?.success?(f.add({title:"Success",description:t?.msg?t?.msg:"Student deactivated",color:"success",duration:2e3}),await r(!1)):(f.add({title:"Failed",description:t?.msg?t?.msg:"Unable to deactivate.",color:"error",duration:2e3}),await r(!1))}catch(t){console.error("Submission error:",t),f.add({title:"Error",description:"An unexpected error occurred.",color:"error"})}};return q(async()=>{await r(!0)}),(o,t)=>{const _=Q,h=ct,u=it,Z=dt,M=rt,S=ut,tt=mt,et=Tt,G=gt,st=ht;return m(),y("div",null,[e("div",Kt,[e("div",Nt,[i(_,{variant:"outline",color:"primary",to:"/students",icon:"i-lucide-arrow-left",class:"w-fit"},{default:g(()=>[...t[5]||(t[5]=[b(" Back to Students ",-1)])]),_:1})]),e("div",Ut,[e("div",Pt,[e("div",Bt,[s(n)?.previous?(m(),j(_,{key:0,variant:"link",color:"neutral",to:`/students/${s(n)?.previous?.id}`,icon:"i-lucide-arrow-left"},{default:g(()=>[b(a(s(n)?.previous?.first_yiddish_name+" "+s(n)?.previous?.last_yiddish_name),1)]),_:1},8,["to"])):$("",!0)]),e("div",Ft,[s(n)?.next?(m(),j(_,{key:0,variant:"link",color:"neutral",to:`/students/${s(n)?.next?.id}`,"trailing-icon":"i-lucide-arrow-right"},{default:g(()=>[b(a(s(n)?.next?.first_yiddish_name+" "+s(n)?.next?.last_yiddish_name),1)]),_:1},8,["to"])):$("",!0)])])])]),s(w)?(m(),y("div",Ht,[i(h,{"show-loader":s(w),size:"md"},null,8,["show-loader"])])):s(n)?.Student&&Object.keys(s(n)?.Student).length>0?(m(),y("div",Vt,[i(S,{class:"rounded-2xl shadow-sm mt-6"},{default:g(()=>[e("div",Ot,[i(u,{size:"3xl",alt:s(n)?.Student?.first_name+" "+s(n)?.Student?.last_name},null,8,["alt"]),e("div",Gt,[e("div",Et,[e("h2",It,a(s(n)?.Student?.first_name+" "+s(n)?.Student?.last_name),1),i(Z,{color:s(n)?.Student?.active===0?"error":"success",variant:"soft"},{default:g(()=>[b(a(s(n)?.Student?.active===0?"Inactive":"Active"),1)]),_:1},8,["color"])]),e("p",Rt,a(s(n)?.Student?.first_yiddish_name+" "+s(n)?.Student?.last_yiddish_name),1),e("div",Yt,[e("p",null,[t[6]||(t[6]=e("span",{class:"font-medium"},"Phone:",-1)),b(" "+a(s(n)?.Student?.phone),1)]),e("p",null,[t[7]||(t[7]=e("span",{class:"font-medium"},"Address:",-1)),b(" "+a(s(n)?.Student?.address),1)]),e("p",null,[t[8]||(t[8]=e("span",{class:"font-medium"},"Wage Group:",-1)),b(" "+a(s(n)?.wage_group),1)])]),e("div",Lt,[e("button",{onClick:t[0]||(t[0]=A=>W(s(n)?.Student)),class:"cursor-pointer"},[i(M,{name:"i-lucide-square-pen",class:"size-5"})]),e("button",null,[i(M,{name:"i-lucide-fingerprint-pattern",class:"size-5"})]),e("button",{onClick:t[1]||(t[1]=A=>J(s(n)?.Student)),class:"cursor-pointer"},[i(M,{name:"i-lucide-toggle-left",class:lt(["size-5",{"rotate-180":s(n)?.Student?.active===1}])},null,8,["class"])]),e("button",{onClick:t[2]||(t[2]=A=>X(s(n)?.Student))},[i(M,{name:"i-lucide-lock-keyhole-open",class:"size-5"})])])])])]),_:1}),e("div",qt,[i(S,{class:"rounded-2xl"},{default:g(()=>[e("div",Qt,[e("div",Wt,[i(M,{name:"i-lucide-wallet",class:"size-5 text-primary-600"})]),e("div",Jt,[t[10]||(t[10]=e("p",{class:"text-sm text-gray-500 mb-2"},"Account Balance",-1)),e("div",Xt,[t[9]||(t[9]=e("p",{class:"text-sm text-gray-600"},"Current",-1)),e("p",Zt,"$"+a(s(n)?.balance),1)])])])]),_:1}),i(S,{class:"rounded-2xl"},{default:g(()=>[e("div",te,[e("div",ee,[i(M,{name:"i-lucide-sun",class:"size-5 text-amber-600"})]),e("div",se,[t[13]||(t[13]=e("p",{class:"text-sm text-gray-500 mb-2"},"Morning %",-1)),e("div",ne,[t[11]||(t[11]=e("p",{class:"text-sm text-gray-600"},"This Month",-1)),e("p",oe,a(s(n)?.percent_m)+"%",1)]),e("div",ae,[t[12]||(t[12]=e("p",{class:"text-sm text-gray-600"},"Last Month",-1)),e("p",ie,a(s(n)?.percent_m_last)+"% ",1)])])])]),_:1}),i(S,{class:"rounded-2xl"},{default:g(()=>[e("div",re,[e("div",le,[i(M,{name:"i-lucide-moon",class:"size-5 text-indigo-600"})]),e("div",ce,[t[16]||(t[16]=e("p",{class:"text-sm text-gray-500 mb-2"},"Afternoon %",-1)),e("div",de,[t[14]||(t[14]=e("p",{class:"text-sm text-gray-600"},"This Month",-1)),e("p",ue,a(s(n)?.percent_a)+"%",1)]),e("div",me,[t[15]||(t[15]=e("p",{class:"text-sm text-gray-600"},"Last Month",-1)),e("p",_e,a(s(n)?.percent_a_last)+"% ",1)])])])]),_:1})]),i(tt,{modelValue:s(x),"onUpdate:modelValue":t[3]||(t[3]=A=>L(x)?x.value=A:null),items:V,class:"mt-6"},null,8,["modelValue"]),s(x)==="0"?(m(),j(S,{key:0},{default:g(()=>[i(et,{items:s(U)},null,8,["items"])]),_:1})):$("",!0),s(x)==="1"?(m(),j(S,{key:1},{default:g(()=>[i(G,{columns:k,loading:s(w),data:s(P),class:"flex-1 mt-6 max-h-112",sticky:""},null,8,["loading","data"])]),_:1})):$("",!0),s(x)==="2"?(m(),j(S,{key:2},{default:g(()=>[i(G,{columns:c,loading:s(w),data:s(D),class:"flex-1 mt-6 max-h-112",sticky:""},null,8,["loading","data"])]),_:1})):$("",!0),s(x)==="3"?(m(),j(S,{key:3},{default:g(()=>[i(G,{columns:F,loading:s(w),data:s(B),class:"flex-1 mt-6 max-h-112",sticky:""},null,8,["loading","data"])]),_:1})):$("",!0)])):(m(),y("div",fe,"No student found")),i(st,{modelValue:s(C),"onUpdate:modelValue":t[4]||(t[4]=A=>L(C)?C.value=A:null),selectedStudent:s(K),onSubmit:d,onCancel:l},null,8,["modelValue","selectedStudent"])])}}};export{Te as default};
