import{r as o,k as ye,m as be,A as ve,c as X,b as s,w as i,a6 as v,g as t,F as he,o as Y,a as d,i as R,ag as g,d as y,t as N,C as Ce,e as we}from"./CQhMbuYm.js";import{_ as Z}from"./yNrD7jeP.js";import{_ as ke}from"./D8yCJ5HV.js";import{_ as xe}from"./ClO5iSXl.js";import{_ as $e}from"./Caw1bJKe.js";import{_ as Se}from"./CoaxiW6z.js";import{_ as De}from"./CGvy3zGA.js";import{_ as Ue}from"./B3zaNuK4.js";import{_ as Ve}from"./Bx822afw.js";import{b as Ge,$ as Pe,a as Me}from"./BklFbpMv.js";import{c as Ee,d as ee,a as Fe}from"./CfhmW9is.js";import{u as Ae}from"./D9TaRR3o.js";import"./C-5-UFas.js";import"./Ccy20JML.js";import"./D6JetA8M.js";import"./DImwLAFM.js";const Oe={class:"flex justify-between items-center gap-4"},Re={class:"flex flex-wrap gap-2 justify-end"},Ne={class:"flex justify-between w-full"},Te={class:"text-xl font-bold text-primary"},je={class:"flex justify-end items-center gap-2 mt-4 border-t border-gray-200 pt-4"},Be={key:0,class:"font-bold"},qe={class:"flex gap-2 justify-end items-center"},na={__name:"index",setup(Le){new Ge("en-US",{dateStyle:"medium"});const h=Pe(Me()),S=h.subtract({days:10}),T=o({start:S,end:h}),j=o({start:S,end:h}),B=o({start:S,end:h}),p=Ae(),D=o(!1),C=o(!1);o(!1);const q=o([]),U=o(!1),V=o(!1),c=o(!1),m=o(!1),w=ye(),L=o([]),f=o(!1),G=o(!1),P=o(""),M=o(""),k=o(!1),x=o(!1),ae=o(null),z=o({}),K=o({}),te=async()=>{c.value=!0,b()},se=async()=>{b(),C.value=!0,await me(),await I({from_date:T.value.start?.toString(),till_date:T.value.end?.toString()})},I=async e=>{try{D.value=!0;const a=await p("/api/payroll/process",{method:"GET",params:{from_date:e?.from_date,till_date:e?.till_date}});a?.success?q.value=Object.values(a?.data||{}):ae.value=a?.message}catch(a){console.log("ðŸš€ ~ fetchProcessRules ~ err:",a)}finally{D.value=!1}},oe=[{accessorKey:"name",header:"Name",cell:({row:e})=>g(we,{to:`/payroll/${e.original.id}`,class:"text-primary hover:underline"},e.original.name)},{accessorKey:"amount",header:"Amount Name"},{header:"Quick Actions",cell:({row:e})=>g("div",{class:"flex gap-2 items-center"},[g(Z,{text:"Edit User"},{default:()=>g(R,{icon:"i-lucide-square-pen",size:"md",color:"success",variant:"soft",onClick:()=>ue(e.original)})}),g(Z,{text:"Delete User"},{default:()=>g(R,{icon:"i-lucide-trash-2",size:"md",color:"error",variant:"soft",onClick:()=>de(e.original)})})])}],le=Ee({name:Fe().required("Name is required"),base_amount:ee().typeError("Base Amount must be a number").required("Base Amount is required"),min_amount:ee().typeError("Min Amount must be a number").nullable()}),u=o({id:null,name:"",base_amount:null,min_amount:0}),r=be({...u.value}),b=()=>{Object.assign(u.value,{id:null,name:"",base_amount:null,min_amount:0}),Object.assign(r,u.value)},Q=()=>{b()},ne=async e=>{try{m.value=!0;const a=u.value.id?`/api/payroll/groups/${u.value.id}`:"/api/payroll/groups",l=u.value.id?"PUT":"POST";delete e.data.id;const $=u.value.id?{name:e.data.name,amount:e.data.base_amount??e.data.min_amount,base_amount:e.data.base_amount,min_amount:e.data.min_amount}:{name:e.data.name,base_amount:e.data.base_amount,min_amount:e.data.min_amount},_=await p(a,{method:l,body:$});_?.success?(w.add({title:"Success",description:_?.message||"Group created successfully",color:"success",duration:2e3}),b(),await E()):w.add({title:"Failed",description:_?._data.errors||_?._data.message||"Failed to create group",color:"error",duration:2e3})}catch(a){console.error("Error creating group:",a)}finally{m.value=!1,c.value=!1}},H=async e=>{try{U.value=!0;const a=await p("/api/payroll/process/checks",{method:"POST",params:{from_date:e?.from_date,till_date:e?.till_date}});a?.success&&(P.value=a?.message),console.log("createChecks",P.value)}catch(a){console.log("ðŸš€ ~ fetchProcessRules ~ err:",a)}finally{U.value=!1}},re=async()=>{k.value=!0,await H({from_date:j.value.start?.toString(),till_date:j.value.end?.toString()})},J=async e=>{try{V.value=!0;const a=await p("/api/payroll/process/deposit",{method:"POST",params:{from_date:e?.from_date,till_date:e?.till_date}});console.log("ðŸš€ ~ fetchProcessDeposit ~ response:",a),a&&(M.value=a?.message),console.log("createChecks",M.value)}catch(a){console.log("ðŸš€ ~ fetchProcessRules ~ err:",a)}finally{V.value=!1}},ie=async()=>{x.value=!0,await J({from_date:B.value.start?.toString(),till_date:B.value.end?.toString()})},E=async()=>{try{G.value=!0;const e=await p("/api/payroll/groups",{method:"GET"});e?.success&&(L.value=e.wages_groups.map(a=>({...a,base_amount:a.amount})))}catch(e){console.log("ðŸš€ ~ fetchGroups ~ err:",e)}finally{G.value=!1}};ve(async()=>{await E()});const ue=e=>{c.value=!0,u.value.id=e.id,r.name=e.name,r.base_amount=e.amount,r.min_amount=e.min_amount},de=e=>{f.value=!0,u.value.id=e.id,r.name=e.name},ce=async()=>{try{m.value=!0;const e=await p(`/api/payroll/groups/${u.value.id}`,{method:"DELETE"});e?.success?(w.add({title:"Success",description:e?.message||"Group deleted successfully",color:"success",duration:2e3}),await E(),b()):w.add({title:"Failed",description:e?._data.errors||e?._data.message||"Failed to delete group",color:"error",duration:2e3})}catch(e){console.error("Error deleting group:",e)}finally{m.value=!1,f.value=!1}},me=async()=>{try{const e=await p("/api/payroll/rules-options");e?.success&&(K.value=e.metrics.reduce((a,l)=>(a[l.metric]=l.description,a),{}),z.value=e.operators.reduce((a,l)=>(a[l.operator]=l.description,a),{}))}catch(e){console.error("An error occurred:",e.message)}},pe=async e=>{!e?.start||!e?.end||await I({from_date:e.start.toString(),till_date:e.end.toString()})},fe=async e=>{!e?.start||!e?.end||await H({from_date:e.start.toString(),till_date:e.end.toString()})},_e=async e=>{!e?.start||!e?.end||await J({from_date:e.start.toString(),till_date:e.end.toString()})};return(e,a)=>{const l=R,$=ke,_=xe,F=$e,A=Se,ge=De,W=Ue,O=Ve;return Y(),X(he,null,[s($,{class:"rounded-2xl shadow-sm"},{default:i(()=>[d("div",Oe,[a[12]||(a[12]=d("h2",{class:"text-xl font-bold"},"Payroll Groups",-1)),d("div",Re,[s(l,{onClick:te,icon:"la:user-plus",label:"New Group"}),s(l,{onClick:se,icon:"i-lucide-settings",label:"Process"}),s(l,{onClick:re,icon:"i-lucide-check-square",label:"Process Checks"}),s(l,{onClick:ie,icon:"i-lucide-wallet",label:"Process Deposit"})])])]),_:1}),s($,{class:"my-6"},{default:i(()=>[s(_,{columns:oe,loading:t(G),data:t(L),class:"flex-1 mt-6"},null,8,["loading","data"])]),_:1}),s(W,{open:t(c),"onUpdate:open":a[5]||(a[5]=n=>v(c)?c.value=n:null)},{header:i(()=>[d("div",Ne,[d("h2",Te,N(t(u).id?"Update Group":"Create New Group"),1),s(l,{size:"sm",variant:"outline",color:"primary",class:"rounded-full p-2",icon:"i-lucide-x",onClick:a[0]||(a[0]=()=>{Q(),c.value=!1})})])]),body:i(()=>[s(ge,{schema:t(le),state:t(r),class:"space-y-4",onSubmit:ne},{default:i(()=>[s(A,{label:"Name",name:"name"},{default:i(()=>[s(F,{modelValue:t(r).name,"onUpdate:modelValue":a[1]||(a[1]=n=>t(r).name=n),placeholder:"Enter group name",class:"w-full"},null,8,["modelValue"])]),_:1}),s(A,{label:"Base Amount",name:"base_amount"},{default:i(()=>[s(F,{modelValue:t(r).base_amount,"onUpdate:modelValue":a[2]||(a[2]=n=>t(r).base_amount=n),modelModifiers:{number:!0},type:"number",placeholder:"Enter base amount",class:"w-full"},null,8,["modelValue"])]),_:1}),s(A,{label:"Min Amount",name:"min_amount"},{default:i(()=>[s(F,{modelValue:t(r).min_amount,"onUpdate:modelValue":a[3]||(a[3]=n=>t(r).min_amount=n),modelModifiers:{number:!0},type:"number",placeholder:"Enter min amount",min:"0",class:"w-full"},null,8,["modelValue"])]),_:1}),d("div",je,[s(l,{color:"neutral",variant:"solid",onClick:a[4]||(a[4]=()=>{Q(),c.value=!1})},{default:i(()=>[...a[13]||(a[13]=[y(" Cancel ",-1)])]),_:1}),s(l,{type:"submit",loading:t(m),disabled:t(m)},{default:i(()=>[y(N(t(u).id?"Update Group":"Create Group"),1)]),_:1},8,["loading","disabled"])])]),_:1},8,["schema","state"])]),_:1},8,["open"]),s(O,{modelValue:t(C),"onUpdate:modelValue":a[6]||(a[6]=n=>v(C)?C.value=n:null),title:"Processing Rules",rules:t(q),loading:t(D),"metric-labels":t(K),"operater-labels":t(z),type:"process",onDateChange:pe},null,8,["modelValue","rules","loading","metric-labels","operater-labels"]),s(O,{modelValue:t(k),"onUpdate:modelValue":a[7]||(a[7]=n=>v(k)?k.value=n:null),title:"Process Checks",loading:t(U),message:t(P),type:"check",onDateChange:fe},null,8,["modelValue","loading","message"]),s(O,{modelValue:t(x),"onUpdate:modelValue":a[8]||(a[8]=n=>v(x)?x.value=n:null),title:"Process Deposit",loading:t(V),message:t(M),type:"deposit",onDateChange:_e},null,8,["modelValue","loading","message"]),s(W,{open:t(f),"onUpdate:open":a[11]||(a[11]=n=>v(f)?f.value=n:null),title:"Confirm Delete Group",close:{color:"primary",variant:"outline",class:"rounded-full"}},{body:i(()=>[d("div",null,[d("p",null,[a[14]||(a[14]=y(" Are you sure you want to delete ",-1)),t(r)?.name?(Y(),X("span",Be,N(t(r)?.name),1)):Ce("",!0),a[15]||(a[15]=y(" this group? ",-1))])]),d("div",qe,[s(l,{color:"neutral",variant:"solid",class:"mt-4",onClick:a[9]||(a[9]=()=>{f.value=!1})},{default:i(()=>[...a[16]||(a[16]=[y(" Cancel ",-1)])]),_:1}),s(l,{color:"error",variant:"solid",class:"mt-4",loading:t(m),disabled:t(m),onClick:a[10]||(a[10]=n=>ce())},{default:i(()=>[...a[17]||(a[17]=[y(" Delete ",-1)])]),_:1},8,["loading","disabled"])])]),_:1},8,["open"])],64)}}};export{na as default};
